var OrneryObject=Class.create({initialize:function(e){this.pos=e,this.vel=new oVec2(0,0),this.rotVel=0,this.area=0,this.fixed=!1,this.type="",this.id=-1,this.color="#FFFFFF",this.user="",this.active=!1,this.rotMat=new oMatrix22(0)}}),OrneryPoly=Class.create(OrneryObject,{initialize:function($super,e,t,n){if($super(e),t.length<3)throw"not enough vertices";this.surfaces=null,this.surfaceAxes=null,this.worldVerts=null,this.vertices=t,this.area=OrneryPoly.FindArea(this.vertices);for(var r=OrneryPoly.FindCenter(this.vertices,this.area),i=0;i<this.vertices.length;i++)this.vertices[i].Subtract(r);this.pos.Add(r),this.boundingRadius=0;for(var i=0;i<this.vertices.length;i++)this.boundingRadius=Math.max(this.boundingRadius,this.vertices[i].Mag());this.fixed=n,this.momentOfInert=this.fixed?Number.POSITIVE_INFINITY:OrneryPoly.FindMomentOfInertia(this.vertices,this.Mass(),new oVec2(this.boundingRadius,this.boundingRadius))},Rotate:function(e){0!=e&&(this.rotMat=oMatrix22.MultMM(new oMatrix22(e),this.rotMat),this.surfaces=null,this.surfaceAxes=null,this.worldVerts=null)},Move:function(e){0!=e.Mag()&&(this.pos.Add(e),this.worldVerts=null)},GetWorldVertices:function(){if(null==this.worldVerts){this.worldVerts=[];for(var e=0;e<this.vertices.length;e++){var t=this.vertices[e],n=oMatrix22.MulTMV(this.rotMat,t);n.Add(this.pos),this.worldVerts.push(n)}}return this.worldVerts},GetSurfaces:function(){if(null==this.surfaces){var e=this.GetWorldVertices();this.surfaces=new Array;for(var t,n=e[e.length-1],r=0;r<e.length;r++){var t=e[r],i=oVec2.Subtract(t,n);this.surfaces.push(i),n=t}}return this.surfaces},GetSurfaceNormals:function(){if(null==this.surfaceAxes){var e=this.GetSurfaces();this.surfaceAxes=new Array;for(var t=0;t<e.length;t++){var n=oVec2.PerpendicularCW(e[t]);n.Normalize(),null!=n&&this.surfaceAxes.push(n)}}return this.surfaceAxes},NewFrame:function(){this.worldVerts=null,this.surfaces=null,this.surfaceAxes=null},Mass:function(){return this.fixed?Number.POSITIVE_INFINITY:this.area},Momentum:function(){return oVec2.Multiply(this.vel,this.Mass()).Mag()},AngularMomentum:function(){return Math.abs(this.rotVel*this.momentOfInert)},GetVelocityOfPoint:function(e){var t=oVec2.CrossZ(this.rotVel,e);return oVec2.Add(t,this.vel)}});OrneryPoly.FindCenter=function(e,t){for(var n,r,i,o=e.length,s=0,a=0,u=o-1,l=0;o>l;u=l++)r=e[l],i=e[u],n=r.x*i.y-i.x*r.y,s+=(r.x+i.x)*n,a+=(r.y+i.y)*n;return n=6*t,new oVec2(s/n,a/n)},OrneryPoly.FindArea=function(e){for(var t,n,r=e.length,i=0,o=r-1,s=0;r>s;o=s++)t=e[s],n=e[o],i+=t.x*n.y,i-=t.y*n.x;if(i/=2,0>i)throw"Area can not be negative";return i},OrneryPoly.FindMomentOfInertia=function(e,t){for(var n,r=0,i=0,o=0,s=e[e.length-1],a=0;a<e.length;a++)n=e[a],r+=Math.abs(oVec2.Cross(n,s))*(oVec2.Dot(n,n)+oVec2.Dot(n,s)+oVec2.Dot(s,s)),i+=Math.abs(oVec2.Cross(n,s)),s=n;if(o=t/6*(r/i),0>o)throw"Moment of inertia cannot be less than 0";return o};